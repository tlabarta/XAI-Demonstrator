<html>
<script src="d3.min.js"></script>
<script src="utils.js"></script>
<script src="socket.io.js"></script>


<head>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@200;300;400;500;600;700;800&display=swap"
        rel="stylesheet">

</head>

<body>
    <div class="logos">
       <img src="website_img/Fraunhofer_HHI.png">
    </div>

    <div class="main">

        <div class="title">
            <span> Explainable AI Demo</span>
        </div>


        <button class="action_button" id="action_button"><i class="fa fa-refresh"></i></button>
        <select id="xaiMethodDropdown">
            <option value="lrp">LRP</option>
            <option value="crp">CRP</option>
        </select>

        <div class="container">
            <div class="output pane">
                <div class="top-row">
                    <div class="smallpane_input">
                        <div class="header">
                            <span>Input</span>
                        </div>
                        <div class='input'>
                            <img id="input_img" src="website_img/temp_image.png">
                        </div>
                    </div>

                    <div class="predictionandlabel">
                        <p id="label">Actual class:  </p>
                        <p id="prediction">Predicted class:  </p>
                    </div>

                    <div class="smallpane_explanation">
                        <div class="header">
                            <span>Explanation</span>
                        </div>
                        <div class="explanation">
                            <img id="explanation_img" src="website_img/heatmap.png">
                        </div>
                    </div>
                </div>

            </div>

            <div class="input pane">
                <div class="input-container shadowed">
                    <div class="header">
                        <span>Network</span>
                    </div>
                    <div class="camera">
                        <video id="video">Video stream not available.</video>
                    </div>
                </div>
        </div>
        <div id="graphic"></div>

    </div>

    <canvas id="canvas"></canvas>

</body>

<script>

    const socket = io();

    // Get the selected XAI method from the dropdown
    var xaiMethodSelector = document.getElementById('xaiMethodDropdown');
    var selectedXaiMethod = xaiMethodSelector.value;

    // Add an event listener to trigger the 'videoframe' event when the page loads
    document.addEventListener('DOMContentLoaded', function () {
        // For example, if you have a dataset ID to specify which dataset to use


        // Emit 'videoframe' event with dataset ID and selected XAI method
        socket.emit('select_input', {xai_method: selectedXaiMethod });
        socket.emit('explain_prediction', {xai_method: xaiMethodSelector.value });

               // Add an event listener for the change event on the dropdown
        xaiMethodSelector.addEventListener('change', function () {
            // Emit 'explain_prediction' event with updated XAI method
            socket.emit('explain_prediction', {xai_method: xaiMethodSelector.value });

        });

    });

    xaiMethodSelector.addEventListener('change', function () {
    // Emit 'explain_prediction' event with updated XAI method
    socket.emit('explain_prediction', {xai_method: xaiMethodSelector.value });

    });

    // Event listener for the button click
    document.getElementById('action_button').addEventListener('click', function () {
        // Emit a custom event to the server
        socket.emit('button_click', {xai_method: xaiMethodSelector.value });
    });

    // Listen for the 'input_image' event from the server
    socket.on('input_image', function (data) {
        // Update the src attribute of the img element with the received image path

        document.getElementById('input_img').src = data.data + '?' + new Date().getTime();

    });

    // Listen for the 'prediction' event from the server
    socket.on("prediction", function (data) {
        var prediction = data.prediction;
        var actual_label = data.actual_label;
        console.log(prediction);

        const responseText = document.getElementById('prediction');
        responseText.textContent = 'Predicted number: ' + String(prediction);

        const actLabel = document.getElementById('label');
        actLabel.textContent = 'Actual number: ' + String(actual_label);



    });

    // Listen for the 'heatmap' event from the server
    socket.on("heatmap", function (data) {
        var heatmapResponse = data.data;
        console.log(heatmapResponse)
        document.getElementById('explanation_img').src = heatmapResponse + '?' + new Date().getTime();


    });


</script>

</html>
